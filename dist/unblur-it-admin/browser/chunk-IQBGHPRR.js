import{a as ee}from"./chunk-AC76AQUK.js";import{a as te,b as ie,c as oe,d as ae,e as re,f as se,g as me,h as pe,i as w,j as E,k as ce,l as de,m as ge,n as ue,o as he,p as fe}from"./chunk-ZMTTECMT.js";import{b as ne,c as le}from"./chunk-YS4PFTRL.js";import{b as z,c as v,e as H,f as R,h as W,i as J,j as $,k as K,m as Q,n as Y,o as Z,u as y,v as S}from"./chunk-NZNMDAMP.js";import"./chunk-WUDCSZXM.js";import"./chunk-Z6G4RG2I.js";import"./chunk-MARRMC7X.js";import{aa as A,ea as X}from"./chunk-5TIFKIA7.js";import{i as q,o as f}from"./chunk-IGVQOOUO.js";import"./chunk-F2X3VGZZ.js";import{$ as D,Hb as p,Ia as _,Ib as k,Ka as o,Kb as P,Lb as B,Mb as O,Nb as U,Ob as j,Pa as N,Pb as G,Ua as u,V as T,_ as I,_a as b,aa as M,fb as a,ia as g,ib as V,na as C,ob as n,pb as t,qb as d,ub as L,yb as c,zb as h}from"./chunk-KHOYMPRU.js";function Se(r,l){r&1&&(n(0,"tr")(1,"th",8),p(2,"Aper\xE7u"),t(),n(3,"th"),p(4,"Titre"),t(),n(5,"th"),p(6,"Progression"),t(),n(7,"th",9),p(8,"Statut"),t(),n(9,"th",10),p(10,"Actions"),t()())}function we(r,l){if(r&1){let e=L();n(0,"tr")(1,"td"),d(2,"img",11),t(),n(3,"td",12),p(4),t(),n(5,"td")(6,"div",13)(7,"span"),p(8),t(),d(9,"p-progressBar",14),t()(),n(10,"td",9),d(11,"p-tag",15),t(),n(12,"td",16)(13,"p-button",17),c("onClick",function(){let s=D(e).$implicit,m=h();return M(m.onEdit.emit(s))}),t(),n(14,"p-button",18),c("onClick",function(){let s=D(e).$implicit,m=h();return M(m.onDelete.emit(s.id))}),t()()()}if(r&2){let e=l.$implicit,i=h();o(2),a("src",e.imageUrl,_)("alt",e.title),o(2),k(e.title),o(4),P("",e.currentViews," / ",e.targetViews,""),o(),a("value",e.currentViews/e.targetViews*100)("showValue",!1),o(2),a("severity",i.getSeverity(e.isActive))("value",e.isActive?"Actif":"En pause"),o(2),a("rounded",!0)("text",!0),o(),a("rounded",!0)("text",!0)}}function Ee(r,l){r&1&&(n(0,"tr")(1,"td",19),p(2," Aucun challenge trouv\xE9. Commencez par en cr\xE9er un ! "),t()())}var x=class r{challenges=[];loading=!1;onAdd=new g;onEdit=new g;onDelete=new g;getSeverity(l){return l?"success":"danger"}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=u({type:r,selectors:[["app-challenge-list"]],inputs:{challenges:"challenges",loading:"loading"},outputs:{onAdd:"onAdd",onEdit:"onEdit",onDelete:"onDelete"},decls:9,vars:4,consts:[[1,"card","shadow-sm","border-round","p-4","bg-white"],[1,"flex","justify-content-between","align-items-center","mb-4"],[1,"m-0","text-900"],["label","Nouveau Challenge","icon","pi pi-plus","severity","success",3,"onClick"],["responsiveLayout","scroll","styleClass","p-datatable-sm p-datatable-striped",3,"value","loading","paginator","rows"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[2,"width","80px"],[1,"text-center"],[1,"text-right",2,"width","120px"],["width","50",1,"shadow-1","border-round",3,"src","alt"],[1,"font-bold"],[1,"progress-info"],["styleClass","progress-mini",3,"value","showValue"],[3,"severity","value"],[1,"text-right"],["icon","pi pi-pencil","severity","warn","pTooltip","Modifier",3,"onClick","rounded","text"],["icon","pi pi-trash","severity","danger","pTooltip","Supprimer",3,"onClick","rounded","text"],["colspan","5",1,"text-center","p-4","text-500"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),p(3,"Liste des Challenges"),t(),n(4,"p-button",3),c("onClick",function(){return i.onAdd.emit()}),t()(),n(5,"p-table",4),b(6,Se,11,0,"ng-template",5)(7,we,15,13,"ng-template",6)(8,Ee,3,0,"ng-template",7),t()()),e&2&&(o(5),a("value",i.challenges)("loading",i.loading)("paginator",!0)("rows",10))},dependencies:[f,pe,me,X,S,y,E,w,se,re,de,ce],encapsulation:2})};function xe(r,l){if(r&1&&(n(0,"div",18),d(1,"img",19),t()),r&2){let e=h();o(),a("src",e.imagePreview,_)}}var F=class r{constructor(l){this.fb=l;this.challengeForm=this.fb.group({title:["",[v.required,v.minLength(3)]],contextText:[""],targetViews:[1e3,[v.required,v.min(1)]],isActive:[!1]})}challenge=null;onSave=new g;onCancel=new g;challengeForm;imagePreview=null;selectedFile=null;ngOnChanges(l){l.challenge&&this.challenge?(this.challengeForm.patchValue({title:this.challenge.title,targetViews:this.challenge.targetViews,isActive:this.challenge.isActive}),this.imagePreview=this.challenge.imageUrl):this.challenge||(this.challengeForm.reset({targetViews:1e3}),this.imagePreview=null,this.selectedFile=null)}onFileSelect(l){this.selectedFile=l.files[0];let e=new FileReader;e.onload=()=>{this.imagePreview=e.result},this.selectedFile&&e.readAsDataURL(this.selectedFile)}submit(){if(this.challengeForm.valid){let l=new FormData;l.append("title",this.challengeForm.get("title")?.value),l.append("targetViews",this.challengeForm.get("targetViews")?.value),l.append("isActive",this.challengeForm.get("isActive")?.value),this.selectedFile&&l.append("image",this.selectedFile),this.onSave.emit(l)}}static \u0275fac=function(e){return new(e||r)(N(K))};static \u0275cmp=u({type:r,selectors:[["app-challenge-form"]],inputs:{challenge:"challenge"},outputs:{onSave:"onSave",onCancel:"onCancel"},features:[I],decls:28,vars:8,consts:[[1,"flex","flex-column","gap-4","py-3",3,"ngSubmit","formGroup"],[1,"flex","align-items-center","justify-content-between","p-3","border-1","surface-border","border-round","bg-gray-50"],[1,"flex","flex-column","gap-1"],[1,"font-bold"],[1,"text-500"],[1,"flex","flex-column","align-items-end","gap-2"],["formControlName","isActive"],[3,"severity","value"],[1,"flex","flex-column","gap-2"],["for","title",1,"font-bold"],["pInputText","","id","title","formControlName","title","placeholder","Ex: Campagne Promo Janvier"],["for","clicks",1,"font-bold"],["id","clicks","formControlName","targetViews","suffix"," clics",3,"min","showButtons"],["class","mb-2 text-center border-round overflow-hidden border-1 surface-border",4,"ngIf"],["mode","basic","chooseLabel","Choisir une image","accept","image/*","maxFileSize","2000000","styleClass","p-button-outlined w-full",3,"onSelect"],[1,"flex","justify-content-end","gap-2","mt-4"],["label","Annuler","severity","secondary",3,"onClick","text"],["label","Enregistrer","icon","pi pi-check",3,"onClick","disabled"],[1,"mb-2","text-center","border-round","overflow-hidden","border-1","surface-border"],["alt","Preview",2,"max-height","200px","width","auto",3,"src"]],template:function(e,i){if(e&1&&(n(0,"form",0),c("ngSubmit",function(){return i.submit()}),n(1,"div",1)(2,"div",2)(3,"label",3),p(4,"Statut du challenge"),t(),n(5,"small",4),p(6,"D\xE9sactiver pour masquer le challenge aux utilisateurs"),t()(),n(7,"div",5),d(8,"p-toggleswitch",6)(9,"p-tag",7),t()(),n(10,"div",8)(11,"label",9),p(12,"Nom du Challenge"),t(),d(13,"input",10),t(),n(14,"div",8)(15,"label",11),p(16,"Objectif de clics"),t(),d(17,"p-inputNumber",12),t(),n(18,"div",8)(19,"label",3),p(20,"Image du Challenge"),t(),b(21,xe,2,1,"div",13),n(22,"p-fileUpload",14),c("onSelect",function(m){return i.onFileSelect(m)}),t(),n(23,"small",4),p(24,"Format recommand\xE9 : 1080x1080px (Max 2Mo)"),t()(),n(25,"div",15)(26,"p-button",16),c("onClick",function(){return i.onCancel.emit()}),t(),n(27,"p-button",17),c("onClick",function(){return i.submit()}),t()()()),e&2){let s,m;a("formGroup",i.challengeForm),o(9),a("severity",(s=i.challengeForm.get("isActive"))!=null&&s.value?"success":"danger")("value",(m=i.challengeForm.get("isActive"))!=null&&m.value?"ACTIF":"INACTIF"),o(8),a("min",1)("showButtons",!0),o(4),a("ngIf",i.imagePreview),o(5),a("text",!0),o(),a("disabled",i.challengeForm.invalid||!i.selectedFile&&!i.challenge)}},dependencies:[f,q,Q,W,z,H,R,J,$,Z,Y,ae,oe,S,y,ue,ge,E,w,fe,he],encapsulation:2})};var Fe=()=>({width:"50vw"}),_e=class r{challengeService=T(ee);messageService=T(A);challenges=C([]);isLoading=C(!1);displayDialog=!1;selectedChallenge=C(null);isEditMode=C(!1);ngOnInit(){this.loadChallenges()}loadChallenges(){this.isLoading.set(!0),this.challengeService.getAllChallenges().subscribe({next:l=>{this.challenges.set(l.data),this.isLoading.set(!1)},error:()=>{this.messageService.add({severity:"error",summary:"Erreur",detail:"Impossible de charger les challenges"}),this.isLoading.set(!1)}})}openCreateDialog(){this.isEditMode.set(!1),this.selectedChallenge.set(null),this.displayDialog=!0}openEditDialog(l){this.isEditMode.set(!0),this.selectedChallenge.set(l),this.displayDialog=!0}handleSave(l){(this.isEditMode()?this.challengeService.updateChallenge(this.selectedChallenge().id,l):this.challengeService.createChallenge(l)).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Succ\xE8s",detail:"Op\xE9ration r\xE9ussie"}),this.displayDialog=!1,this.loadChallenges()},error:()=>this.messageService.add({severity:"error",summary:"Erreur",detail:"L'op\xE9ration a \xE9chou\xE9"})})}handleDelete(l){confirm("Voulez-vous vraiment supprimer ce challenge ?")&&this.challengeService.deleteChallenge(l).subscribe({next:()=>{this.messageService.add({severity:"success",summary:"Supprim\xE9",detail:"Challenge effac\xE9"}),this.loadChallenges()}})}resetSelection(){this.selectedChallenge.set(null)}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=u({type:r,selectors:[["app-challenges"]],features:[j([A])],decls:4,vars:9,consts:[[3,"onAdd","onEdit","onDelete","challenges","loading"],[3,"visibleChange","onHide","visible","header","modal"],[3,"onSave","onCancel","challenge"]],template:function(e,i){e&1&&(n(0,"app-challenge-list",0),c("onAdd",function(){return i.openCreateDialog()})("onEdit",function(m){return i.openEditDialog(m)})("onDelete",function(m){return i.handleDelete(m)}),t(),n(1,"p-dialog",1),U("visibleChange",function(m){return O(i.displayDialog,m)||(i.displayDialog=m),m}),c("onHide",function(){return i.resetSelection()}),n(2,"app-challenge-form",2),c("onSave",function(m){return i.handleSave(m)})("onCancel",function(){return i.displayDialog=!1}),t()(),d(3,"p-toast")),e&2&&(a("challenges",i.challenges())("loading",i.isLoading()),o(),V(G(8,Fe)),B("visible",i.displayDialog),a("header",i.isEditMode()?"Modifier le challenge":"Nouveau challenge")("modal",!0),o(),a("challenge",i.selectedChallenge()))},dependencies:[f,x,F,ie,te,le,ne],encapsulation:2})};export{_e as ChallengesComponent};
